# Компилация. Makefile. CМake (Cross-Platform Make). Преговор от УП
До сега използвахме Visual Studio за компилиране на кода и IDE-то се грижеше за всичко автоматично. Сега ще разгледаме как да компилираме проекти без IDE, защо това е важно, и какви инструменти съществуват за управление на процеса на компилация.

### Процес на компилация
Нарочно опростена картинка за процеса на компилация

![](/utils/images/pract-01/kartinka-ver-01.png)

### Компилация извън IDE-то (чрез g++ компилатора)
```c++
g++ -c main.cpp      // създава файл с машинен код main.o
g++ main.o           // създава изпълним файл с машинен код a.exe
g++ main.cpp         // прави двете горни операции наведнъж
g++ main.cpp -o main // същото като g++ main.cpp, но кръщава изпълнимия файл main.exe
```

### Какво е build системи?
Build система е инструмент, който автоматизира процеса на превръщане на сорс код в изпълним файл. Той определя **какво** трябва да се компилира, **в какъв ред**, и **как** да се свържат всички части заедно.

Примери за build системи са `make`, `ninja`, `MSBuild` (на Visual Studio), `xmake`, `Bazel`

### Защо са ми build системи като IDE-то се грижи за всичко?
Защото, чрез build системи, кодът ви може да се компилира на различни платформи (Linux, macOS, Windows) независимо от конкретно IDE. Всички хора, с които работите по проект могат да използват всякакви IDE-та и други инструменти по свой избор, докато ако споделяте проект написан на Visual Studio с всичките му служебни файлове, затруднявате всички хора, които работят по проекта, но са на други ОС и/или IDE-та,.

![](/utils/images/pract-01/image.png)

Примерно ако Пешо работи на CLion, Алекс на VSCode, а Тошо на Visual Studio, те могат да работят заедно без проблем чрез build система. Това се нарича cross-platform

### Какво е Makefile?

Makefile е текстов файл, който описва как да се компилира проект - кои файлове да се компилират, в какъв ред, с какви флагове, и как да се свържат в изпълним файл. Build системата `make` чете този файл и изпълнява описаните стъпки.

### Какво е CMake?

CMake не е build система, а е **генератор на build системи**. Създава се един `CMakeLists.txt` файл с описание на проекта, а CMake генерира подходящи build файлове за вашата платформа - `Makefile` за Linux/macOS, Visual Studio `.sln` за Windows, Ninja файлове за CLion и т.н.

### Защо точно CMake?
- **Cross-platform** - един `CMakeLists.txt` работи за всяка ОС
- **Интеграция с IDE** - CLion, VS Code, Visual Studio директно разпознават CMake проекти
- **Управление на зависимости** - модерния CMake много опростява работата с външни библиотеки
- **Индустриален стандарт** - почти всички съвременни C++ проекти използват CMake

### Live Demo
```cmake
# Минимална версия на CMake
cmake_minimum_required(VERSION 3.12)

# Име на проекта
project(myprogram-project)

# Създава изпълним файл 'myprogram' от посочените source файлове
add_executable(myprogram myprogram.cpp)
```
---
```cmake
# Минимална версия на CMake
cmake_minimum_required(VERSION 3.10)

# Име на проекта
project(myprogram-project)

# C++ стандарт версия
set(CMAKE_CXX_STANDARD 23)

# Изисква точно C++23 (ако не успее да използва C++23 дава грешка)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Създава изпълним файл 'myprogram' от посочените source файлове
add_executable(myprogram "src/myprogram.cpp" "src/other.cpp")
```